box:
  id:  takumi/linux-kernel-build
  cmd: /bin/sh
build:
  steps:
    - script:
        name: download
        code: |
          if [ -f "$WERCKER_CACHE_DIR/linux-$KERNEL_VERSION.tar.xz" ]; then
            debug "linux-$KERNEL_VERSION.tar.xz found in cache"
          else
            debug "linux-$KERNEL_VERSION.tar.xz not found in cache, will download"
            wget -O "$WERCKER_CACHE_DIR/linux-$KERNEL_VERSION.tar.xz" "https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-$KERNEL_VERSION.tar.xz"
          fi
    - script:
        name: extract
        code: |
          if [ -d "$WERCKER_CACHE_DIR/linux-$KERNEL_VERSION" ]; then
            debug "linux-$KERNEL_VERSION found in cache"
          else
            debug "linux-$KERNEL_VERSION not found in cache, will extract"
            tar -xf "$WERCKER_CACHE_DIR/linux-$KERNEL_VERSION.tar.xz" -C "$WERCKER_CACHE_DIR"
          fi
deploy:
  steps:
    - internal/docker-push:
      disable-sync: true
